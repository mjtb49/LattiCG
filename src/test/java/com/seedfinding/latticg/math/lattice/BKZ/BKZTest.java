package com.seedfinding.latticg.math.lattice.BKZ;

import com.seedfinding.latticg.math.component.BigMatrix;
import com.seedfinding.latticg.math.lattice.LLL.Params;
import com.seedfinding.latticg.math.lattice.optimization.BKZ;
import org.junit.Test;

import static com.seedfinding.latticg.math.lattice.LLL.Params.recommendedDelta;
import static org.junit.Assert.assertEquals;

public class BKZTest {
    @Test
    public void testBKZHugeMatrix() {
        BigMatrix basis = BigMatrix.fromString(
            "{{1,25214903917,205749139540585,233752471717045,55986898099985,120950523281469,76790647859193,61282721086213,128954768138017,177269950146317,19927021227657,92070806603349,28158748839985,118637304785629,127636996050457,12659659028133,120681609298497,262331189124013,31562171905705,1172916755445,193905135338833,247073002637693,112300943448121,219938666776133}," +
                "{281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656,0} ," +
                "{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,281474976710656}}");

        BigMatrix expected = BigMatrix.fromString(
            "{{-27475526524678,11329196910194,-1864071279990,-10181265590078,18797192492698,-1361991394414,-23589572351702,-18511469509918,-7710516328902,-75504188750,12664044556746,-19016843161854,10033589759962,17919967345618,14818119230570,-36901028086494,-2829089336454,21975882819314,829242294538,3609177410,-20482648829670,-43212311714798,-10295697209430,-14892803424414}," +
                "{1090985884319,-13204645605453,-18985430580937,-16798495969685,-25736654084721,-10117634164765,9619888340391,-615642953189,-13673810194561,41833932206867,-33421283045097,-8012507467573,-21216435656593,-6103558098621,11223967230855,-18028355841413,-28777091211169,18231356646003,-2318712554249,27861827313451,-9921022089393,10536736274083,6764261913959,43264105563867}," +
                "{1055428822603,-19851784433681,13322957963971,-5980590661881,19263637946363,-386819981345,8941237685235,-13720700442505,51679985542315,-41390008746289,-18049004750813,13206443579623,-2196673403813,576998997183,-23537770285229,43831426818135,-20419357708533,-24824985376337,21901185350019,14897137479367,3059946615995,-99209497185,-30628486402381,-7898272025545}," +
                "{10030493077001,20511360815061,30464227941297,-12879937613731,2677028963737,-34635356760027,-15113168845375,6835885070637,22008825931305,-21661818530443,-7506700566319,-24356183236867,39303719419833,-7232291334203,1008880655585,8488875946445,-23995601804727,-37604300443883,2994748680689,-6398614330979,34856952978905,-10568470140059,-20520119470079,-30758346621331}," +
                "{-21251518881334,-27290187211006,3358052302810,32112370420690,-7905285229462,15489859161378,2554556162938,-1166866761998,-57668518096630,-29182899913406,41383094526234,2151114961938,-761498003542,-10679909003422,-33381697398598,-1585737145550,11305555077194,15120435749762,-9807780418982,-15894292913070,-6401467997462,-35651626788446,11215373956602,-10003247933582}," +
                "{62778688221022,27475526524678,-11329196910194,1864071279990,10181265590078,-18797192492698,1361991394414,23589572351702,18511469509918,7710516328902,75504188750,-12664044556746,19016843161854,-10033589759962,-17919967345618,-14818119230570,36901028086494,2829089336454,-21975882819314,-829242294538,-3609177410,20482648829670,43212311714798,10295697209430}," +
                "{23659687179776,-27665742447104,-13871589366272,27682415898112,9538779043328,-10527153742336,-13090109241856,51071622958592,3815592474112,12196737809920,39012088587776,-3685945922048,13022728689152,5047250542080,-35970750413312,-1210155430400,36642432316928,-2476171641344,5022471251456,-10933130203648,-12945693420032,44801732976128,788081264128,-4283122496000}," +
                "{-37543625996092,-3703628557452,-6429586522012,-19006094605676,10482947166468,1751159822004,-105208569180,5285613180884,12743391386948,-46439358755340,3265968842980,-17433852526316,-9961640874620,19445085567284,-16343115967708,-3408356688300,-21146012089916,8498457139316,-12953940631196,-5387810943084,22336970283524,-68224077698124,25740306453412,26950558954708}," +
                "{14208940470625,-35265274024883,4467940215497,-4296622641771,-51565491681679,-21394403245027,-3449158726055,-13906048019995,-20242961539967,4007289473261,-10823365395735,-34000158872779,21183868535697,-32236876772675,-22834089385863,-36493951563387,-2089769202783,-15069677741683,31684023652105,1035708923093,6734228882609,39304978957661,14983315510937,12721097463077}," +
                "{4862782738717,-12202273450151,-49354786068763,-18820740133503,-20360329763347,-3342612900887,30173092089909,-1266312018799,7146175739837,47884931926393,35539009420933,-16743690265439,2470372890253,34781482190857,24456946483669,-18954928544335,19854857507421,-577678614631,12943254989349,-9219120386111,-1883130283219,8108087681065,30766653769589,29695113054929}," +
                "{24629355324573,-27074300730151,-8026946623899,10781654226689,-13332087688851,24470486448489,12469229094837,-11264900569583,-7474012964035,-18817179678983,54440454860293,-6507294026207,11416675291661,29896321228169,-7565123786411,-23135516575951,17351144637917,15675214204185,4968948763045,13321297418561,29742060889773,19068948850089,7973693677301,-10398473122735}," +
                "{-30925167838214,45176365196658,27606028344714,26811873415106,15246366917018,-20513084487022,16333645769770,13244130314722,-404479475398,-1195824143950,-31214581201718,-10048136919550,-7396254442790,130361510610,8428107138922,19104896738338,-52310975041926,-889663298062,-28335751179254,-29317682936766,29946387127322,2797992055570,4176132360874,22437569562210}," +
                "{6105492967206,19475524933422,-8898702675306,-4995534680610,-2784003269754,22624468884494,-7988008335882,-49340632773186,9065099808230,47316226887406,13984144322390,7112438754206,-2735091284410,-5967245963314,-8827209232714,-15236607965314,-4079901776730,6995125665454,-647448050666,-31056855744162,-37522608535290,46146639985550,24630346592118,-7628014798530}," +
                "{-22708132933148,-17602323024364,130501820036,38141070325300,13382295637028,-30694350077100,35130838262468,11882138920308,-23994051827100,-19707293653868,-38925097530620,-10123641108300,5267790113956,-18886481651244,18461696898884,37024864083956,-37492855811356,-37790691384556,-31164840515708,-7341800117452,30775629421860,2801601232980,-16306516468796,-20774742152588}," +
                "{-5899558793069,-6295812513641,18102064466507,19579081720815,37593527641795,1914279228167,3957401961467,28802874864607,1979229745139,-7878492439433,-20013003822933,23225873658575,-16555430945757,4020420848871,30026682738779,862983352511,-4030619837613,-34959830404009,14785550906123,-23366802416209,-15996385518205,59688448017095,21866940905659,12149826038175}," +
                "{37889482031010,3456757228538,10880662777202,-2674753682038,-30118345762878,4103378921882,-11911837887854,-13398110350294,-851828698654,-59740878001862,-16220799391310,22161513065674,31789299109378,-25472168148262,-2536684694830,-11599108182166,52561508117538,39836512835194,-28607559209486,-16707107800054,17171775261762,14358032090138,13283369425682,-26595391065430}," +
                "{17541458168954,15427479333874,-44160275717622,-13005871629758,-41985652286950,-16358265685742,10087977171114,-25195035337630,-34348094627398,3056834951218,-23140012500662,36090407059586,1728046400346,-41401094125230,-27632174996502,-12247062231390,14226882436858,40939026893938,26928702060682,-5413050298686,-18626079959910,-9678623153774,17967487334186,6437679282402}," +
                "{11778278634201,-19731915891611,-12030516505343,20791283226477,43608079787881,-13049995851,-10626295200751,-42653466230467,-5426175978247,13613990994949,41657409049633,-9980665284595,12357398891401,41792500203349,-75005651118799,20156925479901,-14589934462183,26561848639397,27925139789633,12243674975405,11127257273257,-23119135787787,-23008778376623,9357961120381}," +
                "{33153643270523,-6812761312417,8876287670643,-795328198665,-13629330616789,17920963881551,19972615208355,-16063272849305,-39209013484069,26575218253887,290722796755,-7408944599081,-36439266129781,24884702283055,25800447979267,60228846810695,-19592469240261,4158355130655,22766629059635,31053618918327,-12130934657301,16346171235343,-10485221479325,3937509627943}," +
                "{5551663873637,8020609076993,15542109030765,3656967139689,-8244727160907,503805926929,11090378576701,23122447122169,-46953621780987,33409087213089,35823863474701,24822685734281,-22809438994091,-42143685431503,7833416474077,-11071112821479,-7817315196507,-10118445674175,-17274045170003,38005003607465,-15953478633739,45792684672081,-25080709866371,30929475137337}," +
                "{-49152502287813,-31401282640609,-463788939213,29578388844471,-27587282552085,4610534979599,51321685923939,13294287459367,-20187357143397,10789527865855,14917426617235,13489367666583,38991512014155,20165750164207,-16630431391293,13625271112199,28022255957755,-16260334916897,-12930375689485,-29196924253321,19193176214443,15021324556751,21220869191459,-2937939989529}," +
                "{7379843735830,-6399306261922,7568442076678,-13765441618802,-21475512542090,-13360669515202,-13322347067290,-11005270788242,41244164992470,9385879881758,26228365371590,23601480712270,-30438115314378,241516997630,-43687610765530,-21531281279186,23891467129494,1346024697310,15979202263942,-14735637595122,19595023623670,16520942923198,-23659966681626,-14159749894418}," +
                "{9290700264187,-6678534220065,8676961490675,-32808412309641,16128051767211,6753678345679,-3345497541853,34112160643047,-21974111299749,23360220787647,-2818014977453,-19367204622505,-3131939024373,4497435300015,1108855936131,9583863672263,47287097771963,8004901964959,1421647067571,-36818647129289,10456082229355,28237552048015,-21203486129693,-35632973774937}," +
                "{30115659926637,54014570166377,-16314380739915,7875278241041,-30617199475139,-7975263078919,-15105806798587,-862867514079,-6869930701555,-32253916103543,-20179676013483,-27279896105423,-5921663799075,14160723729433,-35206539400027,18500509155393,-42975094226515,7071813035177,-33017414176267,6991203722065,21623688499069,-14466225510855,-3111988839355,57574555395937}}");
        assertEquals(expected.toPrettyString(), BKZ.reduce(basis, 11, new Params().setDelta(recommendedDelta)).getReducedBasis().toPrettyString());
    }
}
